<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pok√©mon Trivia - Partida</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-gradient-to-br from-sky-300 via-blue-200 to-emerald-300">

<main class="container mx-auto px-5 py-8 max-w-3xl">
    <div class="text-center mt-4">
        <span id="timer" class="text-2xl font-bold">15</span> segundos restantes
        <div class="w-full h-4 bg-gray-300 rounded-full mt-2">
            <div id="progressBar" class="h-4 bg-sky-400 rounded-full w-full"></div>
            <img src="imagenes/categorias/Cascada.png"
                 class="absolute top-2 right-2 w-12 h-12 object-cover z-10 rounded-full shadow-lg"
                 alt="Icono peque√±o">
        </div>
    </div>
    <!-- T√≠tulo -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-3">üß© Pok√©mon Trivia</h1>
        <p class="text-gray-700">Responde antes de que se acabe el tiempo ‚è±Ô∏è</p>
    </div>

    <!-- Globo de pregunta -->
    {{#pregunta}}
        <div class="bg-white rounded-3xl p-8 border-4 border-gray-800 shadow-2xl mb-10">
            <p id="pregunta" class="text-2xl font-semibold text-gray-900 text-center leading-relaxed">
                {{texto}}
            </p>
        </div>

        <!-- Formulario de respuestas -->
        <form method="POST" action="index.php?controller=Partida&method=responder">
            <input type="hidden" name="pregunta_id" value="{{id}}">

            <div class="space-y-4">
                {{#respuestas}}
                    <button type="submit" name="respuesta" value="{{id}}"
                            class="w-full bg-white hover:bg-gray-50 rounded-2xl p-6 border-4 border-gray-800 shadow-lg hover:shadow-2xl hover:-translate-y-1 transition-all text-left">
                        <div class="flex items-start gap-4">
                            <div class="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center font-black text-xl text-white flex-shrink-0 border-2 border-gray-800">
                                {{letra}}
                            </div>
                            <p class="text-gray-900 font-medium text-lg leading-relaxed pt-1">
                                {{texto}}
                            </p>
                        </div>
                    </button>
                {{/respuestas}}
            </div>
        </form>
    {{/pregunta}}

    {{^pregunta}}
        <div class="bg-red-100 border-2 border-red-400 text-red-700 px-6 py-4 rounded-xl text-center mt-8">
            ‚ùå No se encontr√≥ ninguna pregunta disponible.
        </div>
    {{/pregunta}}

    <script>let tiempoRestante = 15;
    const timerElement = document.getElementById('timer');
    const progressBar = document.getElementById('progressBar');
    const tiempoTotal = 15;

    const countdown = setInterval(() => {
        tiempoRestante--;
        timerElement.textContent = tiempoRestante;

        // Actualizar barra
        const porcentaje = (tiempoRestante / tiempoTotal) * 100;
        progressBar.style.width = porcentaje + "%";

        if (tiempoRestante <= 5) {
            timerElement.classList.add('text-red-600');
        }

        if (tiempoRestante <= 0) {
            clearInterval(countdown);
            timerElement.textContent = '0';

            // Llamada al backend para mostrar vista final
            fetch('/PreguntadosPW2/index.php?controller=Partida&method=partidaFinalizada')
                    .then(response => response.text())
                    .then(html => {
                        document.body.innerHTML = html;
                    });
        }
    }, 1000);
    </script>
</main>

</body>
</html>