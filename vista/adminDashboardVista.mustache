<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - Pokémon Trivia</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .pokemon-border {
            border: 4px solid #2c3e50;
            box-shadow:
                inset -4px -4px 0px rgba(0,0,0,0.3),
                inset 4px 4px 0px rgba(255,255,255,0.3),
                4px 4px 0px rgba(0,0,0,0.2);
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-b from-purple-400 to-indigo-300 flex flex-col">


<header class="bg-white shadow-2xl">
    <div class="container mx-auto px-5 py-4 flex justify-between items-center flex-wrap gap-4">
        <div class="flex items-center gap-3">
            <div class="w-12 h-12
                        flex items-center justify-center pokemon-border">
<?xml version="1.0" encoding="UTF-8"?><svg id="crown-solid" class="w-8 h-8 fill-yellow-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><polygon points="23 7 23 9 22 9 22 10 21 10 21 14 20 14 20 17 19 17 19 19 18 19 18 21 6 21 6 19 5 19 5 17 4 17 4 14 3 14 3 10 2 10 2 9 1 9 1 7 2 7 2 6 4 6 4 7 5 7 5 9 4 9 4 10 5 10 5 11 6 11 6 12 8 12 8 11 9 11 9 9 10 9 10 7 11 7 11 6 10 6 10 4 11 4 11 3 13 3 13 4 14 4 14 6 13 6 13 7 14 7 14 9 15 9 15 11 16 11 16 12 18 12 18 11 19 11 19 10 20 10 20 9 19 9 19 7 20 7 20 6 22 6 22 7 23 7"/></svg>
            </div>
            <div>
                <p class="text-black text-xl font-bold">ADMINISTRADOR</p>
                <p class="text-gray-600 text-sm">Panel de Control</p>
            </div>
        </div>

        <div class="flex items-center gap-3 flex-wrap">
            <form method="GET" action="/admin/dashboard" class="flex items-center gap-3">
                <select name="filtro" class="pokemon-border px-3 py-2 rounded bg-white font-bold">
                    <option value="dia" {{#filtro_dia}}selected{{/filtro_dia}}>Hoy</option>
                    <option value="semana" {{#filtro_semana}}selected{{/filtro_semana}}>Semana</option>
                    <option value="mes" {{#filtro_mes}}selected{{/filtro_mes}}>Mes</option>
                    <option value="año" {{#filtro_año}}selected{{/filtro_año}}>Año</option>
                </select>

                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg 
                            font-bold pokemon-border transition-all hover:scale-105">
                    Filtrar
                </button>
            </form>

            <a href="/admin/gestionarEditores" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg 
                        font-bold pokemon-border transition-all hover:scale-105">
                Gestionar Editores
            </a>

            <a href="/admin/descargarPDF?filtro={{filtro}}" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg 
                        font-bold pokemon-border transition-all hover:scale-105">
                Descargar PDF
            </a>
        </div>
    </div>
</header>

<main class="flex-1 container mx-auto px-5 py-10 space-y-10">


    <section class="grid grid-cols-1 md:grid-cols-4 gap-6">


        <div class="bg-white rounded-2xl p-6 pokemon-border text-center">
            <div class="flex justify-center mb-2">
                <svg id="user-solid" class="w-12 h-12 fill-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <polygon points="7 9 6 9 6 5 7 5 7 3 8 3 8 2 10 2 10 1 14 1 14 2 16 2 16 3 17 3 17 5 18 5 18 9 17 9 17 11 16 11 16 12 14 12 14 13 10 13 10 12 8 12 8 11 7 11 7 9"/>
                    <polygon points="22 19 22 22 21 22 21 23 3 23 3 22 2 22 2 19 3 19 3 18 4 18 4 17 5 17 5 16 7 16 7 15 17 15 17 16 19 16 19 17 20 17 20 18 21 18 21 19 22 19"/>
                </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-700">Usuarios</h3>
            <p class="text-3xl font-bold text-blue-600">{{stats.total_usuarios}}</p>
        </div>


        <div class="bg-white rounded-2xl p-6 pokemon-border text-center ">
            <div class="flex justify-center mb-2">
                <svg id="gaming" class="w-12 h-12 fill-green-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M15.5032 13.502H9.50183V15.5024H15.5032V13.502Z"/>
                    <path d="M22.5048 10.5014V8.50091H21.5045V6.50045H20.5043V5.50023H19.5041V4.5H15.5032V5.50023H9.50182V4.5H5.50091V5.50023H4.50068V6.50045H3.50045V8.50091H2.50023V10.5014H1.5V18.5032H2.50023V19.5034H5.50091V18.5032H6.50114V17.503H7.50136V16.5027H8.50159V13.502H9.50182V12.5018H15.5032V13.502H16.5034V16.5027H17.5036V17.503H18.5039V18.5032H19.5041V19.5034H22.5048V18.5032H23.505V10.5014H22.5048ZM5.50091 8.50091V7.50068H6.50114V6.50045H7.50136V7.50068H8.50159V8.50091H9.50182V9.50114H8.50159V10.5014H7.50136V11.5016H6.50114V10.5014H5.50091V9.50114H4.50068V8.50091H5.50091ZM13.5027 9.50114H12.5025V10.5014H11.5023V9.50114H10.502V8.50091H11.5023V7.50068H12.5025V8.50091H13.5027V9.50114ZM20.5043 10.5014H18.5039V12.5018H16.5034V10.5014H14.503V8.50091H16.5034V6.50045H18.5039V8.50091H20.5043V10.5014Z"/>
                </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-700">Partidas</h3>
            <p class="text-3xl font-bold text-green-600">{{stats.total_partidas}}</p>
        </div>


        <div class="bg-white rounded-2xl p-6 pokemon-border text-center">
            <div class="flex justify-center mb-2">
<svg xmlns="http://www.w3.org/2000/svg"class="w-12 h-12 fill-gray-600" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M18 5v6h-1v1h-2v1h-1v2H9v-3h1v-1h1v-1h2V9h1V7h-1V6h-2v1h-1v1H9v1H8V8H7V7H6V6H5V5h1V4h1V3h2V2h6v1h1v1h1v1zm-5 13h1v3h-1v1h-3v-1H9v-3h1v-1h3z"/></svg>
            </div>
            <h3 class="text-lg font-bold text-gray-700">Preguntas Totales</h3>
            <p class="text-3xl font-bold text-purple-600">{{stats.total_preguntas}}</p>
        </div>


        <div class="bg-white rounded-2xl p-6 pokemon-border text-center">
            <div class="flex justify-center mb-2">
                <svg class="w-12 h-12 fill-red-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <polygon points="23 11 23 13 22 13 22 14 14 14 14 22 13 22 13 23 11 23 11 22 10 22 10 14 2 14 2 13 1 13 1 11 2 11 2 10 10 10 10 2 11 2 11 1 13 1 13 2 14 2 14 10 22 10 22 11 23 11"/>
                </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-700">Preguntas Creadas</h3>
            <p class="text-3xl font-bold text-red-600">{{stats.preguntas_creadas}}</p>
        </div>

    </section>


    <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">

        <div class="bg-white rounded-2xl p-6 pokemon-border">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                <svg class="w-6 h-6 fill-gray-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <polygon points="7 9 6 9 6 5 7 5 7 3 8 3 8 2 10 2 10 1 14 1 14 2 16 2 16 3 17 3 17 5 18 5 18 9 17 9 17 11 16 11 16 12 14 12 14 13 10 13 10 12 8 12 8 11 7 11 7 9"/>
                    <polygon points="22 19 22 22 21 22 21 23 3 23 3 22 2 22 2 19 3 19 3 18 4 18 4 17 5 17 5 16 7 16 7 15 17 15 17 16 19 16 19 17 20 17 20 18 21 18 21 19 22 19"/>
                </svg>
                Usuarios por sexo
            </h2>
            <canvas id="chartSexo"></canvas>
        </div>


<div class="bg-white rounded-2xl p-6 pokemon-border">
    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 fill-gray-700" viewBox="0 0 24 24">
            <path fill="currentColor" d="M18 5v6h-1v1h-2v1h-1v2H9v-3h1v-1h1v-1h2V9h1V7h-1V6h-2v1h-1v1H9v1H8V8H7V7H6V6H5V5h1V4h1V3h2V2h6v1h1v1h1v1zm-5 13h1v3h-1v1h-3v-1H9v-3h1v-1h3z"/>
        </svg>
        Preguntas por Medalla
    </h2>
    <canvas id="chartMedalla"></canvas>
</div>


        <div class="bg-white rounded-2xl p-6 pokemon-border">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                <svg class="w-6 h-6 fill-gray-700" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                </svg>
                Usuarios por edad
            </h2>
            <canvas id="chartEdad"></canvas>
        </div>

    </section>

</main>



<script>

    const datosSexo = [
        {{#stats.usuarios_por_sexo}}
        {label: '{{nombre}}', value: {{total}}},
        {{/stats.usuarios_por_sexo}}
    ];

    const datosMedalla = [
        {{#stats.preguntas_por_medalla}}
        {label: '{{nombre}}', value: {{total}}},
        {{/stats.preguntas_por_medalla}}
    ];

    const datosEdad = {
        menores: {{stats.usuarios_por_edad.menores}},
        adultos: {{stats.usuarios_por_edad.medio}},
        jubilados: {{stats.usuarios_por_edad.jubilados}}
    };


    const pixelColors = {
        primary: [
            '#3B82F6',
            '#EF4444',
            '#10B981',
            '#F59E0B',
            '#8B5CF6',
            '#EC4899',
            '#06B6D4',
            '#F97316'
        ],
        bg: [
            'rgba(59, 130, 246, 0.2)', 
            'rgba(239, 68, 68, 0.2)', 
            'rgba(16, 185, 129, 0.2)', 
            'rgba(245, 158, 11, 0.2)', 
            'rgba(139, 92, 246, 0.2)',
            'rgba(236, 72, 153, 0.2)',
            'rgba(6, 182, 212, 0.2)',
            'rgba(249, 115, 22, 0.2)'
        ]
    };


    const commonOptions = {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    padding: 15,
                    font: {
                        size: 12,
                        weight: 'bold'
                    }
                }
            }
        }
    };


    const ctxSexo = document.getElementById('chartSexo').getContext('2d');
    new Chart(ctxSexo, {
        type: 'doughnut',
        data: {
            labels: datosSexo.map(d => d.label),
            datasets: [{
                data: datosSexo.map(d => d.value),
                backgroundColor: pixelColors.primary.slice(0, datosSexo.length),
                borderColor: '#ffffff',
                borderWidth: 3
            }]
        },
        options: commonOptions
    });


    const ctxMedalla = document.getElementById('chartMedalla').getContext('2d');
    new Chart(ctxMedalla, {
        type: 'bar',
        data: {
            labels: datosMedalla.map(d => d.label),
            datasets: [{
                label: 'Preguntas',
                data: datosMedalla.map(d => d.value),
                backgroundColor: pixelColors.bg.slice(0, datosMedalla.length),
                borderColor: pixelColors.primary.slice(0, datosMedalla.length),
                borderWidth: 3
            }]
        },
        options: {
            ...commonOptions,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1,
                        font: {
                            size: 11,
                            weight: 'bold'
                        }
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    }
                },
                x: {
                    ticks: {
                        font: {
                            size: 10,
                            weight: 'bold'
                        }
                    },
                    grid: {
                        display: false
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.parsed.y + ' pregunta(s)';
                        }
                    }
                }
            }
        }
    });


    const ctxEdad = document.getElementById('chartEdad').getContext('2d');
    new Chart(ctxEdad, {
        type: 'pie',
        data: {
            labels: ['Menores (< 18)', 'Adultos (18-65)', 'Jubilados (> 65)'],
            datasets: [{
                data: [datosEdad.menores, datosEdad.adultos, datosEdad.jubilados],
                backgroundColor: pixelColors.primary.slice(0, 3),
                borderColor: '#ffffff',
                borderWidth: 3
            }]
        },
        options: commonOptions
    });
</script>

</body>
</html>