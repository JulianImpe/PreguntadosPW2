<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lobby - PokÃ©mon Trivia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@3/tsparticles.bundle.min.js"></script>
    <style>
        .pokemon-border {
            border: 4px solid #2c3e50;
            box-shadow:
                    inset -4px -4px 0px rgba(0,0,0,0.3),
                    inset 4px 4px 0px rgba(255,255,255,0.3),
                    4px 4px 0px rgba(0,0,0,0.2);
        }

        .pokeball-bg {
            background: linear-gradient(180deg, #ef4444 0%, #ef4444 45%, #1f2937 45%, #1f2937 55%, #f3f4f6 55%, #f3f4f6 100%);
        }

        .btn-combatir {
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease-in-out;
        }
        
        #electricFx canvas {
            image-rendering: pixelated;
            filter: contrast(130%) brightness(120%);
        }
    </style>
</head>

<body class="min-h-screen bg-gradient-to-b from-sky-400 to-emerald-300">

<!-- Header estilo Game Boy -->
<div class="bg-white shadow-2xl top-0 z-50">
    <div class="container mx-auto px-3 sm:px-5 py-3 sm:py-4">
        <!-- Layout responsive -->
        <div class="flex flex-col gap-3 sm:gap-4">
            
            <!-- Fila 1: Foto + Info -->
            <div class="flex items-center justify-between gap-3">
                <!-- Lado izquierdo: Foto + Entrenador + Nombre -->
                <div class="flex items-center gap-2 sm:gap-3 flex-1 min-w-0">
                    <!-- Foto de perfil -->
                    <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-full overflow-hidden border-3 border-red-700 shadow-lg bg-white flex-shrink-0">
                        {{#tiene_foto}}
                            <img src="{{foto_perfil}}" alt="Foto de perfil" class="w-full h-full object-cover">
                        {{/tiene_foto}}
                        {{^tiene_foto}}
                            <div class="w-full h-full bg-gradient-to-br from-red-400 to-red-600 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </div>
                        {{/tiene_foto}}
                    </div>

                    <!-- Texto -->
                    <div class="min-w-0 flex-1">
                        <p class="text-black text-sm sm:text-lg lg:text-xl font-bold truncate">
                            Entrenador: {{usuario}}
                        </p>
                    </div>
                </div>

                <!-- Puntos (solo desktop) -->
                <div class="hidden lg:flex items-center gap-2 bg-yellow-400 pokemon-border px-4 py-2 rounded-lg flex-shrink-0">
                    <span class="text-lg">Puntaje:</span>
                    <p class="font-black text-gray-800">{{puntaje}}</p>
                </div>
            </div>

            <!-- Fila 2: BotÃ³n Crear Pregunta (responsive) -->
            <div class="flex justify-center sm:justify-end">
                <a href="/sugerencia/form"
                   class="inline-flex items-center justify-center gap-2 bg-green-500 hover:bg-green-600 text-white font-bold text-xs sm:text-sm px-4 sm:px-5 py-2 sm:py-3 rounded-lg pokemon-border transition-all shadow-md hover:scale-105 active:scale-95 w-full sm:w-auto">
                    <svg class="w-6 h-6 sm:w-7 sm:h-7 fill-white flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <polygon points="23 11 23 13 22 13 22 14 14 14 14 22 13 22 13 23 11 23 11 22 10 22 10 14 2 14 2 13 1 13 1 11 2 11 2 10 10 10 10 2 11 2 11 1 13 1 13 2 14 2 14 10 22 10 22 11 23 11"/>
                    </svg>
                    <span class="whitespace-nowrap">Crear Pregunta</span>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Modal QR (oculto por defecto) -->
<div id="modalQR" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl pokemon-border p-6 sm:p-8 max-w-sm w-full relative">
        <button id="btnCerrarQR" class="absolute top-3 right-3 sm:top-4 sm:right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold">Ã—</button>
        <h3 class="text-center pixel-font text-xs sm:text-sm mb-4 text-gray-800">MI CÃ“DIGO QR</h3>
        <div id="qrcode" class="bg-white p-4 rounded-lg flex justify-center"></div>
        <p class="text-center text-gray-600 text-xs mt-4">Escanea para ver mi perfil</p>
    </div>
</div>

<!-- Contenido principal -->
<main class="container mx-auto px-3 sm:px-5 py-4 sm:py-8">

    <!-- Medallas/Stats -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4 mb-6 sm:mb-8">
        <div class="bg-white pokemon-border rounded-xl p-3 sm:p-4 text-center transition-transform">
            <div class="text-3xl sm:text-4xl mb-2 flex items-center justify-center">
                <svg class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 fill-gray-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M15.5032 13.502H9.50183V15.5024H15.5032V13.502Z"/>
                    <path d="M22.5048 10.5014V8.50091H21.5045V6.50045H20.5043V5.50023H19.5041V4.5H15.5032V5.50023H9.50182V4.5H5.50091V5.50023H4.50068V6.50045H3.50045V8.50091H2.50023V10.5014H1.5V18.5032H2.50023V19.5034H5.50091V18.5032H6.50114V17.503H7.50136V16.5027H8.50159V13.502H9.50182V12.5018H15.5032V13.502H16.5034V16.5027H17.5036V17.503H18.5039V18.5032H19.5041V19.5034H22.5048V18.5032H23.505V10.5014H22.5048ZM5.50091 8.50091V7.50068H6.50114V6.50045H7.50136V7.50068H8.50159V8.50091H9.50182V9.50114H8.50159V10.5014H7.50136V11.5016H6.50114V10.5014H5.50091V9.50114H4.50068V8.50091H5.50091ZM13.5027 9.50114H12.5025V10.5014H11.5023V9.50114H10.502V8.50091H11.5023V7.50068H12.5025V8.50091H13.5027V9.50114ZM20.5043 10.5014H18.5039V12.5018H16.5034V10.5014H14.503V8.50091H16.5034V6.50045H18.5039V8.50091H20.5043V10.5014Z"/>
                    <path d="M18.5039 8.50098H16.5034V10.5014H18.5039V8.50098Z"/>
                </svg>
            </div>
            <p class="text-gray-600 text-[0.6rem] sm:text-xs font-bold">PARTIDAS</p>
            <p class="text-gray-800 text-lg sm:text-xl md:text-2xl font-black">{{partidas_jugadas}}</p>
        </div>

        <div class="bg-gradient-to-br from-yellow-300 to-yellow-500 pokemon-border rounded-xl p-3 sm:p-4 text-center transition-transform">
            <div class="text-3xl sm:text-4xl mb-2 flex items-center justify-center">
                <svg class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 fill-yellow-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="m18,4v-2H6v2H1v5h1v2h1v1h1v1h1v1h1v1h3v1h2v3h-4v3h10v-3h-4v-3h2v-1h3v-1h1v-1h1v-1h1v-1h1v-2h1v-5h-5ZM5,12v-1h-1v-2h-1v-3h2v1h1v2h1v3h1v1h-2v-1h-1Zm16-3h-1v2h-1v1h-1v1h-2v-1h1v-2h1v-3h1v-1h2v3Z"/>
                </svg>
            </div>
            <p class="text-yellow-900 text-[0.6rem] sm:text-xs font-bold">VICTORIAS</p>
            <p class="text-yellow-900 text-lg sm:text-xl md:text-2xl font-black">{{partidas_ganadas}}</p>
        </div>

        <div class="bg-gradient-to-br from-blue-400 to-blue-600 pokemon-border rounded-xl p-3 sm:p-4 text-center transition-transform relative group">
            <div class="text-3xl sm:text-4xl mb-2 flex items-center justify-center">
                <svg class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 fill-blue-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <polygon points="23 8 23 10 22 10 22 11 21 11 21 12 20 12 20 13 19 13 19 14 18 14 18 19 19 19 19 23 17 23 17 22 15 22 15 21 13 21 13 20 11 20 11 21 9 21 9 22 7 22 7 23 5 23 5 19 6 19 6 14 5 14 5 13 4 13 4 12 3 12 3 11 2 11 2 10 1 10 1 8 8 8 8 6 9 6 9 4 10 4 10 2 11 2 11 1 13 1 13 2 14 2 14 4 15 4 15 6 16 6 16 8 23 8"/>
                </svg>
            </div>
            <div class="flex items-center justify-center gap-1 sm:gap-2">
                <p class="text-blue-100 text-[0.6rem] sm:text-xs font-bold">NIVEL</p>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" class="text-blue-100 cursor-help flex-shrink-0">
                    <path fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11t-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8t-.288-.712T12 7t-.712.288T11 8t.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"/>
                </svg>
            </div>
            <p class="text-white text-lg sm:text-xl md:text-2xl font-black">{{nivel}}</p>

            <!-- Tooltip -->
            <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block w-48 sm:w-64 z-10">
                <div class="bg-gray-900 text-white text-[0.6rem] sm:text-xs px-3 sm:px-4 py-2 sm:py-3 shadow-xl border-2 border-blue-400">
                    <p class="leading-relaxed">
                        El <strong>nivel 5 es el medio</strong>. Tu nivel sube o baja segÃºn cÃ³mo te vaya en las partidas.
                        <br>
                        (Min - NV1 <br>
                        Max - NV10)
                    </p>
                    <div class="absolute top-full left-1/2 transform -translate-x-1/2 -mt-1">
                        <div class="border-8 border-transparent border-t-gray-900"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-gradient-to-br from-orange-400 to-red-500 pokemon-border rounded-xl p-3 sm:p-4 text-center transition-transform">
            <div class="text-3xl sm:text-4xl mb-2 flex items-center justify-center">
                <svg class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 fill-red-800" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <polygon points="23 7 23 9 22 9 22 10 21 10 21 14 20 14 20 17 19 17 19 19 18 19 18 21 6 21 6 19 5 19 5 17 4 17 4 14 3 14 3 10 2 10 2 9 1 9 1 7 2 7 2 6 4 6 4 7 5 7 5 9 4 9 4 10 5 10 5 11 6 11 6 12 8 12 8 11 9 11 9 9 10 9 10 7 11 7 11 6 10 6 10 4 11 4 11 3 13 3 13 4 14 4 14 6 13 6 13 7 14 7 14 9 15 9 15 11 16 11 16 12 18 12 18 11 19 11 19 10 20 10 20 9 19 9 19 7 20 7 20 6 22 6 22 7 23 7"/>
                </svg>
            </div>
            <p class="text-red-100 text-[0.6rem] sm:text-xs font-bold">RANKING</p>
            <p class="text-white text-lg sm:text-xl md:text-2xl font-black">#{{ranking}}</p>
        </div>
    </div>

    <div class="flex justify-center mb-6 sm:mb-8">
        <!-- BotÃ³n Combatir -->
        <form method="GET" action="/PreguntadosPW2/index.php">
            <input type="hidden" name="controller" value="Lobby">
            <input type="hidden" name="method" value="crearPartidaVista">
            <button id="electricFx" type="submit"
                    class="btn-combatir relative bg-gradient-to-b from-red-500 to-red-700 hover:from-red-600 hover:to-red-800 text-white pixel-font text-sm sm:text-base md:text-lg px-6 sm:px-8 py-4 sm:py-6 rounded-full pokemon-border hover:scale-105 transition-all active:scale-95">
                <div class="flex items-center justify-center gap-2 sm:gap-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 flex-shrink-0" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M12 2a10 10 0 0 1 10 10a10 10 0 0 1-10 10A10 10 0 0 1 2 12A10 10 0 0 1 12 2m0 2c-4.08 0-7.45 3.05-7.94 7h4.07c.44-1.73 2.01-3 3.87-3s3.43 1.27 3.87 3h4.07c-.49-3.95-3.86-7-7.94-7m0 16c4.08 0 7.45-3.05 7.94-7h-4.07c-.44 1.73-2.01 3-3.87 3s-3.43-1.27-3.87-3H4.06c.49 3.95 3.86 7 7.94 7m0-10a2 2 0 0 0-2 2a2 2 0 0 0 2 2a2 2 0 0 0 2-2a2 2 0 0 0-2-2"/>
                    </svg>
                    <span>Â¡COMBATIR!</span>
                </div>
            </button>
        </form>
    </div>

    <!-- MenÃº principal - estilo PokÃ©dex -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8">

        <!-- Ranking -->
        <div class="bg-gradient-to-br from-yellow-300 to-yellow-500 pokemon-border rounded-2xl p-4 sm:p-6">
            <div class="flex items-center gap-3 sm:gap-4 mb-3 sm:mb-4">
                <svg class="w-10 h-10 sm:w-12 sm:h-12 fill-yellow-800 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <polygon points="16 20 15 20 15 21 2 21 2 20 1 20 1 17 2 17 2 16 3 16 3 15 4 15 4 14 13 14 13 15 14 15 14 16 15 16 15 17 16 17 16 20"/>
                    <polygon points="13 12 13 11 14 11 14 5 18 5 18 6 19 6 19 11 18 11 18 12 13 12"/>
                    <polygon points="23 17 23 20 22 20 22 21 16 21 16 20 17 20 17 16 16 16 16 15 15 15 15 14 20 14 20 15 21 15 21 16 22 16 22 17 23 17"/>
                    <path d="m12,3v1h-1v1h-1v-1h-1v-1h-1v1h-1v1h-1v-1h-1v-1h-1v7h1v1h1v1h5v-1h1v-1h1V3h-1Zm-1,6h-1v1h-3v-1h-1v-2h5v2Z"/>
                </svg>
                <div class="min-w-0">
                    <h2 class="pixel-font text-yellow-900 text-xs sm:text-sm mb-1">LIGA</h2>
                    <p class="text-yellow-800 text-[0.6rem] sm:text-xs">Tabla de clasificaciÃ³n</p>
                </div>
            </div>
            <a href="/ranking/verRanking"
               class="block bg-gray-800 hover:bg-yellow-800 text-white text-center px-4 sm:px-6 py-2 sm:py-3 text-xs sm:text-sm font-bold hover:-translate-y-1 transition-all cursor-pointer drop-shadow-md pokemon-border active:scale-95">
                VER ENTRENADORES
            </a>
        </div>

        <!-- Perfil -->
        <div class="bg-gradient-to-br from-blue-400 to-blue-600 pokemon-border rounded-2xl p-4 sm:p-6">
            <div class="flex items-center gap-3 sm:gap-4 mb-3 sm:mb-4">
                <svg class="w-10 h-10 sm:w-12 sm:h-12 fill-blue-800 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <polygon points="7 9 6 9 6 5 7 5 7 3 8 3 8 2 10 2 10 1 14 1 14 2 16 2 16 3 17 3 17 5 18 5 18 9 17 9 17 11 16 11 16 12 14 12 14 13 10 13 10 12 8 12 8 11 7 11 7 9"/>
                    <polygon points="22 19 22 22 21 22 21 23 3 23 3 22 2 22 2 19 3 19 3 18 4 18 4 17 5 17 5 16 7 16 7 15 17 15 17 16 19 16 19 17 20 17 20 18 21 18 21 19 22 19"/>
                </svg>
                <div class="min-w-0">
                    <h2 class="pixel-font text-blue-100 text-xs sm:text-sm mb-1">PERFIL</h2>
                    <p class="text-blue-200 text-[0.6rem] sm:text-xs">Datos personales</p>
                </div>
            </div>
            <a href="/perfil/ver"
               class="block bg-gray-800 hover:bg-blue-800 text-white text-center px-4 sm:px-6 py-2 sm:py-3 text-xs sm:text-sm font-bold hover:-translate-y-1 transition-all cursor-pointer drop-shadow-md pokemon-border active:scale-95">
                VER MI PERFIL
            </a>
        </div>

    </div>

    <!-- Historial - estilo diÃ¡logo PokÃ©mon -->
    <div class="bg-white pokemon-border rounded-2xl p-4 sm:p-6">
        <div class="flex items-center gap-2 sm:gap-3 mb-4 sm:mb-5 pb-3 sm:pb-4 border-b-4 border-gray-300">
            <svg class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 fill-gray-800 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="m22,9v-2h-1v-2h-1v-1h-1v-1h-2v-1h-2v-1h-6v1h-2v1h-2v1h-1v1h-1v2h-1v2h-1v6h1v2h1v2h1v1h1v1h2v1h2v1h6v-1h2v-1h2v-1h1v-1h1v-2h1v-2h1v-6h-1Zm-9,7v-1h-1v-1h-1V5h2v8h1v1h1v1h1v1h-1v1h-1v-1h-1Z"/>
            </svg>
            <h2 class="pixel-font text-gray-800 text-xs sm:text-sm">HISTORIAL</h2>
        </div>

        {{#partidas_recientes}}
            <div class="bg-gradient-to-r from-gray-100 to-gray-200 pokemon-border rounded-xl p-3 sm:p-4 mb-3 hover:from-gray-200 hover:to-gray-300 transition-all flex justify-between items-center gap-3">
                <div class="min-w-0 flex-1">
                    <p class="text-gray-800 font-bold text-xs sm:text-sm truncate">{{fecha}}</p>
                    <p class="text-gray-600 text-[0.6rem] sm:text-xs mt-1 flex flex-wrap items-center gap-2">
                        <span class="inline-block bg-yellow-400 px-2 py-1 rounded font-bold">{{puntos_obtenidos}} PTS</span>
                        <span>{{correctas}}/{{totales}} correctas</span>
                    </p>
                </div>
                <div class="flex-shrink-0">
                    {{#ganada}}
                        <svg class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 fill-green-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="m22,2v-1H2v1h-1v20h1v1h20v-1h1V2h-1ZM5,11h1v-1h1v-1h1v1h1v1h1v1h2v-1h1v-1h1v-1h1v-1h1v-1h1v1h1v1h1v1h-1v1h-1v1h-1v1h-1v1h-1v1h-1v1h-1v1h-2v-1h-1v-1h-1v-1h-1v-1h-1v-1h-1v-1Z"/>
                        </svg>
                    {{/ganada}}
                    {{^ganada}}
                        <svg class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 fill-red-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="m22,2v-1H2v1h-1v20h1v1h20v-1h1V2h-1Zm-4,7h-1v1h-1v1h-1v2h1v1h1v1h1v1h-1v1h-1v1h-1v-1h-1v-1h-1v-1h-2v1h-1v1h-1v1h-1v-1h-1v-1h-1v-1h1v-1h1v-1h1v-2h-1v-1h-1v-1h-1v-1h1v-1h1v-1h1v1h1v1h1v1h2v-1h1v-1h1v-1h1v1h1v1h1v1Z"/>
                        </svg>
                    {{/ganada}}
                </div>
            </div>
        {{/partidas_recientes}}

        {{^partidas_recientes}}
            <div class="text-center py-6 sm:py-8 bg-gray-100 rounded-xl">
                <p class="text-gray-500 font-bold text-xs sm:text-sm mb-2">Â¡No hay batallas registradas!</p>
                <p class="text-4xl sm:text-5xl mb-3">ðŸŽ®</p>
                <p class="text-gray-400 text-xs sm:text-sm">Empieza tu aventura ahora</p>
            </div>
        {{/partidas_recientes}}
    </div>

</main>

<!-- LibrerÃ­a QRCode.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
    const btnMostrarQR = document.getElementById('btnMostrarQR');
    const modalQR = document.getElementById('modalQR');
    const qrcodeDiv = document.getElementById('qrcode');
    let qrCodeGenerado = false;

    if (btnMostrarQR) {
        btnMostrarQR.addEventListener('click', () => {
            modalQR.classList.remove('hidden');

            if (!qrCodeGenerado) {
                const usuarioId = btnMostrarQR.dataset.usuarioId;
                const urlPerfil = window.location.origin + '/perfil/perfilCompartidoVista?id=' + usuarioId;

                new QRCode(qrcodeDiv, {
                    text: urlPerfil,
                    width: 200,
                    height: 200,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                });
                qrCodeGenerado = true;
            }
        });
    }

    const btnCerrarQR = document.getElementById('btnCerrarQR');
    if (btnCerrarQR) {
        btnCerrarQR.addEventListener('click', () => {
            modalQR.classList.add('hidden');
        });
    }

    // Cerrar modal al hacer clic fuera
    modalQR?.addEventListener('click', (e) => {
        if (e.target === modalQR) {
            modalQR.classList.add('hidden');
        }
    });
</script>

</body>
</html>