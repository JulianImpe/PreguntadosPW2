<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokémon Trivia - Partida</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-gradient-to-br from-sky-300 via-blue-200 to-emerald-300">

<!-- Mensaje de feedback flotante -->
<div id="feedbackMessage" class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 px-12 py-8 rounded-3xl shadow-2xl text-white text-4xl font-bold border-4 border-white animate-pulse">
</div>

<main class="container mx-auto px-5 py-8 max-w-3xl">
    <div class="text-center mt-4">
        <span id="timer" class="text-2xl font-bold">15</span> segundos restantes
        <div class="w-full h-4 bg-gray-300 rounded-full mt-2">
            <div id="progressBar" class="h-4 bg-sky-400 rounded-full w-full transition-all duration-300"></div>
        </div>
    </div>

    <!-- Título -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-3">
            <img src="public/img/categorias/Cascada.png"
                 class="absolute top-2 right-2 w-12 h-12 object-cover z-10 rounded-full shadow-lg"
                 alt="Icono pequeño"> Pokémon Trivia
        </h1>
        <p class="text-gray-700">Responde antes de que se acabe el tiempo ⏱️</p>
    </div>

    <!-- Globo de pregunta -->
    {{#pregunta}}
        <div class="bg-white rounded-3xl p-8 border-4 border-gray-800 shadow-2xl mb-10">
            <p id="pregunta" class="text-2xl font-semibold text-gray-900 text-center leading-relaxed">
                {{texto}}
            </p>
        </div>

        <!-- Formulario de respuestas -->
        <form id="formRespuestas" method="POST" action="partida/responder">
            <input type="hidden" name="pregunta_id" value="{{id}}">
            <input type="hidden" name="respuesta" id="respuestaInput" value="">
            <input type="hidden" name="respuesta_id_correcta" value="{{respuesta_correcta_id}}">

            <div class="space-y-4">
                {{#respuestas}}
                    <button type="button"
                            data-respuesta-id="{{id}}"
                            data-correcta="{{es_correcta_str}}"
                            class="respuesta-btn w-full bg-white hover:bg-gray-50 rounded-2xl p-6 border-4 border-gray-800 shadow-lg hover:shadow-2xl hover:-translate-y-1 transition-all text-left">
                        <div class="flex items-start gap-4">
                            <div class="letra-circulo w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center font-black text-xl text-white flex-shrink-0 border-2 border-gray-800">
                                {{letra}}
                            </div>
                            <p class="text-gray-900 font-medium text-lg leading-relaxed pt-1">
                                {{texto}}
                            </p>
                        </div>
                    </button>
                {{/respuestas}}
            </div>
        </form>
    {{/pregunta}}

    {{^pregunta}}
        <div class="bg-red-100 border-2 border-red-400 text-red-700 px-6 py-4 rounded-xl text-center mt-8">
            ❌ No se encontró ninguna pregunta disponible.
        </div>
    {{/pregunta}}

    <div class="fixed top-8 left-8 z-40">
        <div class="bg-gradient-to-b from-yellow-300 to-yellow-400 rounded-2xl p-4 border-4 border-gray-900 shadow-2xl transform -rotate-2">
            <div class="bg-gray-900 rounded-lg p-3 border-2 border-yellow-500">
                <div class="flex items-center gap-2 mb-1">
                    <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                    <span class="text-yellow-300 text-xs font-bold tracking-wider">SCORE</span>
                </div>
                <div class="bg-green-900 rounded px-3 py-2 border-2 border-green-700">
                    <span id="puntajeDisplay" class="text-green-400 text-3xl font-mono font-bold tracking-wider block text-center" style="text-shadow: 0 0 10px rgba(34, 197, 94, 0.5);">
                        {{pregunta.puntaje_actual}}
                    </span>
                </div>
                <div class="flex gap-1 mt-2 justify-center">
                    <div class="w-1.5 h-1.5 bg-red-600 rounded-full"></div>
                    <div class="w-1.5 h-1.5 bg-blue-600 rounded-full"></div>
                    <div class="w-1.5 h-1.5 bg-green-600 rounded-full"></div>
                </div>
            </div>
        </div>
    </div>

</main>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        let tiempoRestante = 15;
        const timerElement = document.getElementById('timer');
        const progressBar = document.getElementById('progressBar');
        const tiempoTotal = 15;
        let countdownInterval;

        // Iniciar countdown
        countdownInterval = setInterval(() => {
            tiempoRestante--;
            timerElement.textContent = tiempoRestante;

            const porcentaje = (tiempoRestante / tiempoTotal) * 100;
            progressBar.style.width = porcentaje + "%";

            if (tiempoRestante <= 5) {
                timerElement.classList.add('text-red-600');
                progressBar.classList.remove('bg-sky-400');
                progressBar.classList.add('bg-red-500');
            } else if (tiempoRestante <= 10) {
                progressBar.classList.remove('bg-sky-400');
                progressBar.classList.add('bg-yellow-500');
            }

            if (tiempoRestante <= 0) {
                clearInterval(countdownInterval);
                timerElement.textContent = '0';

                // Mostrar mensaje de tiempo agotado
                const feedbackEl = document.getElementById('feedbackMessage');
                feedbackEl.textContent = '⏱️ ¡TIEMPO AGOTADO!';
                feedbackEl.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 px-12 py-8 rounded-3xl shadow-2xl text-white text-4xl font-bold border-4 border-white bg-orange-500 animate-pulse';
                feedbackEl.classList.remove('hidden');

                // Enviar formulario después de 2 segundos
                setTimeout(() => {
                    document.getElementById('formRespuestas').submit();
                }, 2000);
            }
        }, 1000);

        // Función para mostrar feedback
        function mostrarFeedback(esCorrecta) {
            const feedbackEl = document.getElementById('feedbackMessage');

            if (esCorrecta) {
                feedbackEl.textContent = '✓ ¡CORRECTO!';
                feedbackEl.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 px-12 py-8 rounded-3xl shadow-2xl text-white text-4xl font-bold border-4 border-white bg-green-500 animate-pulse';
            } else {
                feedbackEl.textContent = '✗ INCORRECTO';
                feedbackEl.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 px-12 py-8 rounded-3xl shadow-2xl text-white text-4xl font-bold border-4 border-white bg-red-500 animate-pulse';
            }

            feedbackEl.classList.remove('hidden');
        }

        // Función para marcar respuesta
        function marcarRespuesta(boton, esCorrecta) {
            if (esCorrecta) {
                boton.classList.remove('bg-white', 'hover:bg-gray-50', 'border-gray-800');
                boton.classList.add('bg-green-400', 'border-green-600');
                const circulo = boton.querySelector('.letra-circulo');
                circulo.classList.remove('bg-orange-500', 'border-gray-800');
                circulo.classList.add('bg-green-600', 'border-green-800');
            } else {
                boton.classList.remove('bg-white', 'hover:bg-gray-50', 'border-gray-800');
                boton.classList.add('bg-red-400', 'border-red-600');
                const circulo = boton.querySelector('.letra-circulo');
                circulo.classList.remove('bg-orange-500', 'border-gray-800');
                circulo.classList.add('bg-red-600', 'border-red-800');
            }
        }

        // Función para mostrar la respuesta correcta
        function mostrarRespuestaCorrecta() {
            document.querySelectorAll('.respuesta-btn').forEach(btn => {
                const dataCorrecta = btn.getAttribute('data-correcta');
                const esCorrecta = (dataCorrecta === '1');

                if (esCorrecta) {
                    btn.classList.remove('bg-white', 'hover:bg-gray-50', 'border-gray-800');
                    btn.classList.add('bg-green-400', 'border-green-600');
                    const circulo = btn.querySelector('.letra-circulo');
                    circulo.classList.remove('bg-orange-500', 'border-gray-800');
                    circulo.classList.add('bg-green-600', 'border-green-800');
                }
            });
        }

        // Manejador de clics en respuestas
        document.querySelectorAll('.respuesta-btn').forEach(boton => {
            boton.addEventListener('click', function(e) {
                e.preventDefault();

                // Detener el timer
                clearInterval(countdownInterval);

                // Deshabilitar todos los botones
                document.querySelectorAll('.respuesta-btn').forEach(btn => {
                    btn.disabled = true;
                    btn.classList.remove('hover:bg-gray-50', 'hover:shadow-2xl', 'hover:-translate-y-1');
                    btn.style.pointerEvents = 'none';
                });

                const respuestaId = this.getAttribute('data-respuesta-id');
                const dataCorrecta = this.getAttribute('data-correcta');
                const esCorrecta = (dataCorrecta === '1');

                // Marcar la respuesta seleccionada
                marcarRespuesta(this, esCorrecta);

                // Si es incorrecta, mostrar también la correcta
                if (!esCorrecta) {
                    mostrarRespuestaCorrecta();
                }

                // Mostrar feedback
                mostrarFeedback(esCorrecta);

                // Guardar la respuesta para enviar
                document.getElementById('respuestaInput').value = respuestaId;

                // Esperar 2 segundos y enviar el formulario
                setTimeout(() => {
                    document.getElementById('formRespuestas').submit();
                }, 2000);
            });
        });
    });
</script>

</body>
</html>